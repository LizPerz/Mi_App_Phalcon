<style>
    html, body { margin: 0; padding: 0; }
    .fade-out { transition: all 0.5s ease; opacity: 0; transform: translateX(20px); }
    .modal-enter { animation: modalIn 0.3s ease-out forwards; }
    @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    @media (max-width: 640px) {
        .fecha-columna { display: none; }
        .tabla-movil td:nth-child(2) { display: none; }
        .pagination-text { font-size: 0.75rem; }
        .pagination-btn { padding: 0.5rem; }
    }
    .spinner {
        animation: spin 1s linear infinite;
        display: inline-block;
    }
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    .filtro-label {
        font-size: 0.85rem;
        letter-spacing: 0.05em;
    }
    @media (min-width: 768px) {
        .filtro-label {
            font-size: 0.9rem;
        }
    }
    .pagination-btn {
        @apply bg-slate-800 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded-xl transition border border-slate-600 disabled:opacity-50 disabled:cursor-not-allowed;
    }
    .pagination-btn.active {
        @apply bg-blue-600 hover:bg-blue-500 border-blue-500;
    }
</style>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<div class="w-full min-h-screen bg-fixed bg-center bg-cover flex items-center justify-center px-4 sm:px-6 lg:px-10 font-sans"
     style="background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop');">

    <div class="w-full max-w-xl sm:max-w-4xl lg:max-w-7xl bg-slate-900/80 backdrop-blur-xl border border-slate-700 rounded-[2rem] shadow-2xl p-5 sm:p-8 lg:p-10 relative">

        <nav class="w-full md:w-fit flex flex-wrap items-center text-base md:text-lg text-slate-400 mb-8 bg-slate-800/50 p-3 rounded-2xl border border-slate-600 shadow-lg backdrop-blur-sm">
            <a href="<?= $this->url->get('hola/index') ?>" class="hover:text-blue-400 transition flex items-center gap-2 group">
                <i data-lucide="home" class="w-5 h-5 group-hover:scale-110 transition-transform"></i> 
                <span>Inicio</span>
            </a>
            <span class="mx-3 text-slate-600">/</span>
            <a href="<?= $this->url->get('hola/formulario') ?>" class="hover:text-green-400 transition flex items-center gap-2 group">
                <i data-lucide="clipboard-list" class="w-5 h-5 group-hover:scale-110 transition-transform"></i> 
                <span>Formulario</span>
            </a>
            <span class="mx-3 text-slate-600">/</span>
            <span class="text-white font-bold flex items-center gap-2">
                <i data-lucide="table-2" class="w-5 h-5 text-sky-400"></i> 
                <span>Lista de Alumnos</span>
            </span>
        </nav>

        <div class="mb-4 text-white font-bold text-sm sm:text-base">
            <?php echo $this->flash->output(); ?>
        </div>

        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl sm:text-4xl font-black text-white tracking-tight"> Alumnos</h1>
                <p class="text-slate-400 text-sm">Gestiona los alumnos registrados</p>
            </div>
            
            <a href="<?= $this->url->get('hola/registro') ?>" 
               class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-3 px-8 rounded-2xl transition shadow-lg flex items-center gap-2">
                <i data-lucide="plus-circle" class="w-5 h-5"></i> 
                Nuevo 
            </a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-6 bg-slate-800/50 p-5 rounded-2xl border border-slate-700">
            
            <div class="md:col-span-4 relative group">
                <label class="filtro-label text-slate-400 ml-1 mb-1 block font-bold uppercase">Buscar</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="search" class="h-5 w-5 text-slate-400"></i>
                    </div>
                    <input type="text" id="buscador" placeholder="Escribe un nombre..." 
                           oninput="cargarAlumnos()"
                           class="block w-full pl-10 p-3 rounded-xl bg-slate-900 border border-slate-600 text-white focus:outline-none focus:border-blue-500 transition">
                </div>
            </div>

            <div class="md:col-span-4 flex gap-2">
                <div class="w-1/2">
                    <label class="filtro-label text-slate-400 ml-1 mb-1 block font-bold uppercase">Desde</label>
                    <input type="date" id="fechaInicio" 
                           onchange="cargarAlumnos()"
                           class="block w-full p-3 rounded-xl bg-slate-900 border border-slate-600 text-white focus:outline-none focus:border-blue-500 transition [color-scheme:dark]">
                </div>
                <div class="w-1/2">
                    <label class="filtro-label text-slate-400 ml-1 mb-1 block font-bold uppercase">Hasta</label>
                    <input type="date" id="fechaFin" 
                           onchange="cargarAlumnos()"
                           class="block w-full p-3 rounded-xl bg-slate-900 border border-slate-600 text-white focus:outline-none focus:border-blue-500 transition [color-scheme:dark]">
                </div>
            </div>

            <div class="md:col-span-4">
                <label class="filtro-label text-slate-400 ml-1 mb-1 block font-bold uppercase">Filtro / Orden</label>
                <div class="relative">
                    <select id="ordenar" onchange="manejarCambioOrden()" class="block w-full p-3 rounded-xl bg-slate-900 border border-slate-600 text-white focus:border-purple-500 transition cursor-pointer appearance-none">
                        <option value="todos" selected>üîÑ Mostrar Todos</option>
                        <option value="fecha_desc">üìÖ Fecha: M√°s reciente</option>
                        <option value="fecha_asc">üìÖ Fecha: M√°s antigua</option>
                        <option value="nombre_asc">üÖ∞Ô∏è Nombre: A - Z</option>
                        <option value="nombre_desc">üí§ Nombre: Z - A</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i data-lucide="chevron-down" class="h-4 w-4 text-slate-400"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="overflow-x-auto rounded-2xl border border-slate-700 shadow-xl">
            <table class="min-w-full text-left text-white border-collapse text-sm sm:text-base">
                <thead class="bg-slate-800 text-slate-300">
                    <tr>
                        <th class="p-4 uppercase text-xs font-bold tracking-widest border-b border-slate-600">Nombre</th>
                        <th class="fecha-columna p-4 uppercase text-xs font-bold tracking-widest border-b border-slate-600 text-center">Registro</th>
                        <th class="p-4 uppercase text-xs font-bold tracking-widest border-b border-slate-600 text-right">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaAlumnos" class="divide-y divide-slate-700/50">
                    <tr>
                        <td colspan="3" class="p-10 text-center">
                            <div class="flex justify-center items-center gap-3">
                                <div class="spinner w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"></div>
                                <span class="text-slate-400">Cargando alumnos...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="flex flex-col sm:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-white text-lg font-bold pagination-text">
                Mostrando <span id="inicioPaginacion">0</span> - <span id="finPaginacion">0</span> de <span id="totalPaginacion">0</span> alumnos
            </div>
           <div class="flex gap-2 flex-wrap justify-center">
    <button id="btnPrimero" onclick="irPagina('primero')" class="pagination-btn" disabled>
        <i data-lucide="chevrons-left" class="w-8 h-8 text-white"></i>
    </button>
    <button id="btnAnterior" onclick="irPagina('anterior')" class="pagination-btn" disabled>
        <i data-lucide="chevron-left" class="w-8 h-8 text-white"></i>
    </button>
    
    <span id="indicadorPagina" class="pagination-btn bg-blue-600 border-blue-500 px-4 text-lg font-bold flex items-center">
        P√°gina 1
    </span>

    <button id="btnSiguiente" onclick="irPagina('siguiente')" class="pagination-btn" disabled>
        <i data-lucide="chevron-right" class="w-8 h-8 text-white"></i>
    </button>
    <button id="btnUltimo" onclick="irPagina('ultimo')" class="pagination-btn" disabled>
        <i data-lucide="chevrons-right" class="w-8 h-8 text-white"></i>
    </button>
</div>
        </div>

    </div>
</div>

<div id="modalEditar" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
    <div class="bg-slate-900 border border-slate-600 p-8 rounded-3xl w-full max-w-md shadow-2xl modal-enter relative">
        <div class="absolute -top-12 left-1/2 -translate-x-1/2 bg-amber-500 p-4 rounded-full shadow-xl shadow-amber-500/30">
            <i data-lucide="edit" class="w-8 h-8 text-black"></i>
        </div>
        <h3 class="text-2xl font-black text-white mb-2 text-center mt-6">Editar Alumno</h3>
        <input type="hidden" id="editId">
        <div class="mb-6">
            <label class="block text-slate-400 mb-2">Nombre</label>
            <input type="text" id="editNombre" class="w-full p-4 rounded-2xl bg-slate-800 border-2 border-slate-600 text-white focus:border-amber-500 focus:outline-none">
        </div>
        <div class="flex gap-3">
            <button onclick="cerrarModal()" class="w-1/2 py-3 rounded-xl bg-slate-700 hover:bg-slate-600 transition text-white">Cancelar</button>
            <button onclick="guardarEdicion()" class="w-1/2 py-3 rounded-xl bg-amber-500 text-black font-bold hover:bg-amber-400 transition">Guardar</button>
        </div>
    </div>
</div>

<div id="modalConfirmar" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
    <div class="bg-slate-900 border border-red-900/50 p-8 rounded-3xl w-full max-w-md shadow-2xl modal-enter relative text-center">
        <div class="w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6">
            <i data-lucide="alert-triangle" class="w-10 h-10 text-red-500"></i>
        </div>
        <h3 class="text-2xl font-black text-white mb-2">¬øEst√°s seguro?</h3>
        <p class="text-slate-400 mb-6">Esta acci√≥n no se puede deshacer</p>
        <div class="flex gap-3">
            <button onclick="cerrarConfirmacion()" class="w-1/2 py-3 rounded-xl bg-slate-700 hover:bg-slate-600 transition text-white">Cancelar</button>
            <button onclick="ejecutarEliminacion()" class="w-1/2 py-3 rounded-xl bg-red-600 font-bold hover:bg-red-500 transition text-white">Eliminar</button>
        </div>
    </div>
</div>

<div id="modalExito" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-[60] flex items-center justify-center p-4">
    <div class="bg-slate-800 border border-green-500/30 p-8 rounded-3xl w-full max-w-sm text-center">
        <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
            <i data-lucide="check-circle-2" class="w-10 h-10 text-green-400"></i>
        </div>
        <h3 class="text-2xl font-black text-white mb-2">¬°Excelente!</h3>
        <p id="textoExito" class="text-slate-300 mb-6"></p>
        <button onclick="cerrarExito()" class="w-full bg-green-500 text-black font-bold py-3 rounded-xl hover:bg-green-400 transition">Entendido</button>
    </div>
</div>

<script>
    lucide.createIcons();
    
    let idParaEliminar = null;
    let ordenActual = 'todos';
    let todosLosAlumnos = [];
    let paginaActual = 1;
    const registrosPorPagina = 5;

    function manejarCambioOrden() {
        const select = document.getElementById('ordenar');
        ordenActual = select.value;
        
        if (ordenActual === 'todos') {
            document.getElementById('buscador').value = '';
            document.getElementById('fechaInicio').value = '';
            document.getElementById('fechaFin').value = '';
        }
        cargarAlumnos();
    }

    function convertirFecha(fechaStr) {
        if (!fechaStr || fechaStr === '---') return null;
        const partes = fechaStr.split('/');
        return new Date(partes[2], partes[1] - 1, partes[0]);
    }

    function actualizarPaginacion() {
        const totalRegistros = todosLosAlumnos.length;
        const totalPaginas = Math.ceil(totalRegistros / registrosPorPagina);
        
        if (paginaActual > totalPaginas) paginaActual = totalPaginas || 1;
        if (paginaActual < 1) paginaActual = 1;
        
        const inicio = (paginaActual - 1) * registrosPorPagina;
        const fin = Math.min(inicio + registrosPorPagina, totalRegistros);
        
        document.getElementById('inicioPaginacion').textContent = totalRegistros > 0 ? inicio + 1 : 0;
        document.getElementById('finPaginacion').textContent = fin;
        document.getElementById('totalPaginacion').textContent = totalRegistros;
        document.getElementById('indicadorPagina').textContent = `P√°gina ${paginaActual} de ${totalPaginas || 1}`;
        
        document.getElementById('btnPrimero').disabled = paginaActual === 1;
        document.getElementById('btnAnterior').disabled = paginaActual === 1;
        document.getElementById('btnSiguiente').disabled = paginaActual === totalPaginas || totalPaginas === 0;
        document.getElementById('btnUltimo').disabled = paginaActual === totalPaginas || totalPaginas === 0;
        
        const tbody = document.getElementById('tablaAlumnos');
        tbody.innerHTML = '';
        
        if (totalRegistros === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="3" class="p-10 text-center text-slate-500 italic bg-slate-800/20">
                        No se encontraron resultados.
                    </td>
                </tr>
            `;
            return;
        }
        
        for (let i = inicio; i < fin; i++) {
            const alumno = todosLosAlumnos[i];
            const fila = document.createElement('tr');
            fila.id = `fila-${alumno.id}`;
            fila.className = 'hover:bg-slate-800/50 transition duration-200 tabla-movil';
            
            const nombreSeguro = alumno.nombre.replace(/'/g, "\\'");
            
            fila.innerHTML = `
                <td class="p-4 font-medium text-lg text-slate-200 break-words">${alumno.nombre}</td>
                <td class="fecha-columna p-4 text-center text-sm text-slate-400">${alumno.fecha}</td>
                <td class="p-4 text-right">
                    <div class="flex justify-end gap-3">
                        <button onclick="abrirModal(${alumno.id}, '${nombreSeguro}')" 
                                class="bg-amber-500 text-black p-2 rounded-lg hover:scale-105 transition"
                                title="Editar">
                            <i data-lucide="edit-3" class="w-4 h-4"></i>
                        </button>
                        <button onclick="abrirConfirmacion(${alumno.id})" 
                                class="bg-red-600 text-white p-2 rounded-lg hover:scale-105 transition"
                                title="Eliminar">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </td>
            `;
            
            tbody.appendChild(fila);
        }
        
        lucide.createIcons();
    }

    function irPagina(direccion) {
        const totalPaginas = Math.ceil(todosLosAlumnos.length / registrosPorPagina);
        
        switch(direccion) {
            case 'primero':
                paginaActual = 1;
                break;
            case 'anterior':
                if (paginaActual > 1) paginaActual--;
                break;
            case 'siguiente':
                if (paginaActual < totalPaginas) paginaActual++;
                break;
            case 'ultimo':
                paginaActual = totalPaginas;
                break;
        }
        
        actualizarPaginacion();
    }

    function cargarAlumnos() {
        const texto = document.getElementById('buscador').value;
        const fInicio = document.getElementById('fechaInicio').value;
        const fFin = document.getElementById('fechaFin').value;
        const tbody = document.getElementById('tablaAlumnos');
        
        let orden = ordenActual;
        if (orden === 'todos') {
            orden = 'fecha_desc';
        }

        tbody.innerHTML = `
            <tr>
                <td colspan="3" class="p-10 text-center">
                    <div class="flex justify-center items-center gap-3">
                        <div class="spinner w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"></div>
                        <span class="text-slate-400">Buscando alumnos...</span>
                    </div>
                </td>
            </tr>
        `;

        fetch("<?= $this->url->get('hola/buscar') ?>", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                texto: texto, 
                fInicio: fInicio, 
                fFin: fFin, 
                orden: orden
            })
        })
        .then(res => {
            if (!res.ok) {
                throw new Error('Error en la respuesta del servidor');
            }
            return res.json();
        })
        .then(data => {
            if (!data.data || data.data.length === 0) {
                todosLosAlumnos = [];
                paginaActual = 1;
                actualizarPaginacion();
                return;
            }

            let datosMostrar = [...data.data];

            if (fInicio && !fFin && ordenActual !== 'fecha_asc' && ordenActual !== 'fecha_desc' && ordenActual !== 'todos') {
                datosMostrar.sort((a, b) => {
                    const fechaA = convertirFecha(a.fecha);
                    const fechaB = convertirFecha(b.fecha);
                    return fechaA - fechaB;
                });
            }

            if (fInicio && !fFin) {
                const fechaDesde = new Date(fInicio + 'T00:00:00');
                const alumnosFiltrados = datosMostrar.filter(alumno => {
                    const fechaAlumno = convertirFecha(alumno.fecha);
                    return fechaAlumno && fechaAlumno >= fechaDesde;
                });
                
                alumnosFiltrados.sort((a, b) => {
                    const fechaA = convertirFecha(a.fecha);
                    const fechaB = convertirFecha(b.fecha);
                    return fechaA - fechaB;
                });
                
                datosMostrar = alumnosFiltrados;
            }

            if (fInicio && fFin) {
                const fechaDesde = new Date(fInicio + 'T00:00:00');
                const fechaHasta = new Date(fFin + 'T23:59:59');
                const alumnosFiltrados = datosMostrar.filter(alumno => {
                    const fechaAlumno = convertirFecha(alumno.fecha);
                    return fechaAlumno && fechaAlumno >= fechaDesde && fechaAlumno <= fechaHasta;
                });
                
                if (ordenActual === 'fecha_asc' || ordenActual === 'fecha_desc' || ordenActual === 'todos') {
                    alumnosFiltrados.sort((a, b) => {
                        const fechaA = convertirFecha(a.fecha);
                        const fechaB = convertirFecha(b.fecha);
                        return ordenActual === 'fecha_desc' ? fechaB - fechaA : fechaA - fechaB;
                    });
                }
                
                datosMostrar = alumnosFiltrados;
            }

            todosLosAlumnos = datosMostrar;
            paginaActual = 1;
            actualizarPaginacion();
        })
        .catch(err => {
            console.error('Error:', err);
            tbody.innerHTML = `
                <tr>
                    <td colspan="3" class="p-10 text-center text-red-500">
                        Error al cargar los datos. Por favor, intenta de nuevo.
                    </td>
                </tr>
            `;
        });
    }

    function abrirModal(id, nombre) {
        document.getElementById('editId').value = id;
        document.getElementById('editNombre').value = nombre;
        document.getElementById('modalEditar').classList.remove('hidden');
        setTimeout(() => document.getElementById('editNombre').focus(), 100);
    }
    
    function cerrarModal() { 
        document.getElementById('modalEditar').classList.add('hidden'); 
    }

    function guardarEdicion() {
        const id = document.getElementById('editId').value;
        const nombre = document.getElementById('editNombre').value.trim();
        
        if(!nombre) { 
            alert('El nombre no puede estar vac√≠o'); 
            return; 
        }

        fetch("<?= $this->url->get('hola/editar') ?>", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: id, nombre: nombre })
        })
        .then(r => r.json())
        .then(d => {
            if(d.status === 'success') {
                cargarAlumnos(); 
                cerrarModal();
                mostrarExito('Alumno actualizado correctamente');
            } else { 
                alert('Error al actualizar el alumno'); 
            }
        })
        .catch(() => alert('Error de conexi√≥n al actualizar'));
    }

    function abrirConfirmacion(id) {
        idParaEliminar = id;
        document.getElementById('modalConfirmar').classList.remove('hidden');
    }
    
    function cerrarConfirmacion() { 
        document.getElementById('modalConfirmar').classList.add('hidden'); 
        idParaEliminar = null;
    }

    function ejecutarEliminacion() {
        if(!idParaEliminar) return;
        const idLocal = idParaEliminar;
        
        fetch("<?= $this->url->get('hola/eliminar/') ?>" + idLocal, { 
            method: 'GET', 
            headers: { 'Accept': 'application/json' } 
        })
        .then(r => r.json())
        .then(d => {
            cerrarConfirmacion();
            if(d.status === 'success') {
                todosLosAlumnos = todosLosAlumnos.filter(a => a.id !== idLocal);
                actualizarPaginacion();
                mostrarExito('Alumno eliminado correctamente');
            } else { 
                alert('Error al eliminar el alumno'); 
            }
        })
        .catch(() => alert('Error de conexi√≥n al eliminar'));
    }

    function mostrarExito(msg) {
        document.getElementById('textoExito').innerText = msg;
        document.getElementById('modalExito').classList.remove('hidden');
        setTimeout(cerrarExito, 2000);
    }
    
    function cerrarExito() { 
        document.getElementById('modalExito').classList.add('hidden'); 
    }

    document.addEventListener('DOMContentLoaded', function() {
        cargarAlumnos();
    });
</script>

<!-- <style>
    html, body { margin: 0; padding: 0; }
    .fade-out { transition: all 0.5s ease; opacity: 0; transform: translateX(20px); }
    .modal-enter { animation: modalIn 0.3s ease-out forwards; }
    @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    @media (max-width: 640px) {
        .fecha-columna { display: none; }
        .tabla-movil td:nth-child(2) { display: none; }
    }
    .spinner {
        animation: spin 1s linear infinite;
        display: inline-block;
    }
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    .filtro-label {
        font-size: 0.85rem;
        letter-spacing: 0.05em;
    }
    @media (min-width: 768px) {
        .filtro-label {
            font-size: 0.9rem;
        }
    }
</style>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<div class="w-full min-h-screen bg-fixed bg-center bg-cover flex items-center justify-center px-4 sm:px-6 lg:px-10 font-sans"
     style="background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop');">

    <div class="w-full max-w-xl sm:max-w-4xl lg:max-w-7xl bg-slate-900/80 backdrop-blur-xl border border-slate-700 rounded-[2rem] shadow-2xl p-5 sm:p-8 lg:p-10 relative">

        <nav class="w-full md:w-fit flex flex-wrap items-center text-base md:text-lg text-slate-400 mb-8 bg-slate-800/50 p-3 rounded-2xl border border-slate-600 shadow-lg backdrop-blur-sm">
            <a href="<?= $this->url->get('hola/index') ?>" class="hover:text-blue-400 transition flex items-center gap-2 group">
                <i data-lucide="home" class="w-5 h-5 group-hover:scale-110 transition-transform"></i> 
                <span>Inicio</span>
            </a>
            <span class="mx-3 text-slate-600">/</span>
            <a href="<?= $this->url->get('hola/formulario') ?>" class="hover:text-green-400 transition flex items-center gap-2 group">
                <i data-lucide="clipboard-list" class="w-5 h-5 group-hover:scale-110 transition-transform"></i> 
                <span>Formulario</span>
            </a>
            <span class="mx-3 text-slate-600">/</span>
            <span class="text-white font-bold flex items-center gap-2">
                <i data-lucide="table-2" class="w-5 h-5 text-sky-400"></i> 
                <span>Lista de Alumnos</span>
            </span>
        </nav>

        <div class="mb-4 text-white font-bold text-sm sm:text-base">
            <?php echo $this->flash->output(); ?>
        </div>

        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl sm:text-4xl font-black text-white tracking-tight"> Alumnos</h1>
                <p class="text-slate-400 text-sm">Gestiona los alumnos registrados</p>
            </div>
            
            <a href="<?= $this->url->get('hola/registro') ?>" 
               class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-3 px-8 rounded-2xl transition shadow-lg flex items-center gap-2">
                <i data-lucide="plus-circle" class="w-5 h-5"></i> 
                Nuevo 
            </a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-6 bg-slate-800/50 p-5 rounded-2xl border border-slate-700">
            
            <div class="md:col-span-4 relative group">
                <label class="filtro-label text-slate-400 ml-1 mb-1 block font-bold uppercase">Buscar</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="search" class="h-5 w-5 text-slate-400"></i>
                    </div>
                    <input type="text" id="buscador" placeholder="Escribe un nombre..." 
                           oninput="cargarAlumnos()"
                           class="block w-full pl-10 p-3 rounded-xl bg-slate-900 border border-slate-600 text-white focus:outline-none focus:border-blue-500 transition">
                </div>
            </div>

            <div class="md:col-span-4 flex gap-2">
                <div class="w-1/2">
                    <label class="filtro-label text-slate-400 ml-1 mb-1 block font-bold uppercase">Desde</label>
                    <input type="date" id="fechaInicio" 
                           onchange="cargarAlumnos()"
                           class="block w-full p-3 rounded-xl bg-slate-900 border border-slate-600 text-white focus:outline-none focus:border-blue-500 transition [color-scheme:dark]">
                </div>
                <div class="w-1/2">
                    <label class="filtro-label text-slate-400 ml-1 mb-1 block font-bold uppercase">Hasta</label>
                    <input type="date" id="fechaFin" 
                           onchange="cargarAlumnos()"
                           class="block w-full p-3 rounded-xl bg-slate-900 border border-slate-600 text-white focus:outline-none focus:border-blue-500 transition [color-scheme:dark]">
                </div>
            </div>

            <div class="md:col-span-4">
                <label class="filtro-label text-slate-400 ml-1 mb-1 block font-bold uppercase">Filtro / Orden</label>
                <div class="relative">
                    <select id="ordenar" onchange="manejarCambioOrden()" class="block w-full p-3 rounded-xl bg-slate-900 border border-slate-600 text-white focus:border-purple-500 transition cursor-pointer appearance-none">
                        <option value="todos" selected>üîÑ Mostrar Todos</option>
                        <option value="fecha_desc">üìÖ Fecha: M√°s reciente</option>
                        <option value="fecha_asc">üìÖ Fecha: M√°s antigua</option>
                        <option value="nombre_asc">üÖ∞Ô∏è Nombre: A - Z</option>
                        <option value="nombre_desc">üí§ Nombre: Z - A</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i data-lucide="chevron-down" class="h-4 w-4 text-slate-400"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="overflow-x-auto rounded-2xl border border-slate-700 shadow-xl">
            <table class="min-w-full text-left text-white border-collapse text-sm sm:text-base">
                <thead class="bg-slate-800 text-slate-300">
                    <tr>
                        <th class="p-4 uppercase text-xs font-bold tracking-widest border-b border-slate-600">Nombre</th>
                        <th class="fecha-columna p-4 uppercase text-xs font-bold tracking-widest border-b border-slate-600 text-center">Registro</th>
                        <th class="p-4 uppercase text-xs font-bold tracking-widest border-b border-slate-600 text-right">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaAlumnos" class="divide-y divide-slate-700/50">
                    <tr>
                        <td colspan="3" class="p-10 text-center">
                            <div class="flex justify-center items-center gap-3">
                                <div class="spinner w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"></div>
                                <span class="text-slate-400">Cargando alumnos...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>

<div id="modalEditar" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
    <div class="bg-slate-900 border border-slate-600 p-8 rounded-3xl w-full max-w-md shadow-2xl modal-enter relative">
        <div class="absolute -top-12 left-1/2 -translate-x-1/2 bg-amber-500 p-4 rounded-full shadow-xl shadow-amber-500/30">
            <i data-lucide="edit" class="w-8 h-8 text-black"></i>
        </div>
        <h3 class="text-2xl font-black text-white mb-2 text-center mt-6">Editar Alumno</h3>
        <input type="hidden" id="editId">
        <div class="mb-6">
            <label class="block text-slate-400 mb-2">Nombre</label>
            <input type="text" id="editNombre" class="w-full p-4 rounded-2xl bg-slate-800 border-2 border-slate-600 text-white focus:border-amber-500 focus:outline-none">
        </div>
        <div class="flex gap-3">
            <button onclick="cerrarModal()" class="w-1/2 py-3 rounded-xl bg-slate-700 hover:bg-slate-600 transition text-white">Cancelar</button>
            <button onclick="guardarEdicion()" class="w-1/2 py-3 rounded-xl bg-amber-500 text-black font-bold hover:bg-amber-400 transition">Guardar</button>
        </div>
    </div>
</div>

<div id="modalConfirmar" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
    <div class="bg-slate-900 border border-red-900/50 p-8 rounded-3xl w-full max-w-md shadow-2xl modal-enter relative text-center">
        <div class="w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6">
            <i data-lucide="alert-triangle" class="w-10 h-10 text-red-500"></i>
        </div>
        <h3 class="text-2xl font-black text-white mb-2">¬øEst√°s seguro?</h3>
        <p class="text-slate-400 mb-6">Esta acci√≥n no se puede deshacer</p>
        <div class="flex gap-3">
            <button onclick="cerrarConfirmacion()" class="w-1/2 py-3 rounded-xl bg-slate-700 hover:bg-slate-600 transition text-white">Cancelar</button>
            <button onclick="ejecutarEliminacion()" class="w-1/2 py-3 rounded-xl bg-red-600 font-bold hover:bg-red-500 transition text-white">Eliminar</button>
        </div>
    </div>
</div>

<div id="modalExito" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-[60] flex items-center justify-center p-4">
    <div class="bg-slate-800 border border-green-500/30 p-8 rounded-3xl w-full max-w-sm text-center">
        <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
            <i data-lucide="check-circle-2" class="w-10 h-10 text-green-400"></i>
        </div>
        <h3 class="text-2xl font-black text-white mb-2">¬°Excelente!</h3>
        <p id="textoExito" class="text-slate-300 mb-6"></p>
        <button onclick="cerrarExito()" class="w-full bg-green-500 text-black font-bold py-3 rounded-xl hover:bg-green-400 transition">Entendido</button>
    </div>
</div>

<script>
    lucide.createIcons();
    
    let idParaEliminar = null;
    let ordenActual = 'todos';

    function manejarCambioOrden() {
        const select = document.getElementById('ordenar');
        ordenActual = select.value;
        
        if (ordenActual === 'todos') {
            document.getElementById('buscador').value = '';
            document.getElementById('fechaInicio').value = '';
            document.getElementById('fechaFin').value = '';
        }
        cargarAlumnos();
    }

    function convertirFecha(fechaStr) {
        if (!fechaStr || fechaStr === '---') return null;
        const partes = fechaStr.split('/');
        return new Date(partes[2], partes[1] - 1, partes[0]);
    }

    function cargarAlumnos() {
        const texto = document.getElementById('buscador').value;
        const fInicio = document.getElementById('fechaInicio').value;
        const fFin = document.getElementById('fechaFin').value;
        const tbody = document.getElementById('tablaAlumnos');
        
        let orden = ordenActual;
        if (orden === 'todos') {
            orden = 'fecha_desc';
        }

        tbody.innerHTML = `
            <tr>
                <td colspan="3" class="p-10 text-center">
                    <div class="flex justify-center items-center gap-3">
                        <div class="spinner w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"></div>
                        <span class="text-slate-400">Buscando alumnos...</span>
                    </div>
                </td>
            </tr>
        `;

        fetch("<?= $this->url->get('hola/buscar') ?>", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                texto: texto, 
                fInicio: fInicio, 
                fFin: fFin, 
                orden: orden
            })
        })
        .then(res => {
            if (!res.ok) {
                throw new Error('Error en la respuesta del servidor');
            }
            return res.json();
        })
        .then(data => {
            tbody.innerHTML = '';
            
            if (!data.data || data.data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="3" class="p-10 text-center text-slate-500 italic bg-slate-800/20">
                            No se encontraron resultados.
                        </td>
                    </tr>
                `;
                return;
            }

            let datosMostrar = [...data.data];

            if (fInicio && !fFin && ordenActual !== 'fecha_asc' && ordenActual !== 'fecha_desc' && ordenActual !== 'todos') {
                datosMostrar.sort((a, b) => {
                    const fechaA = convertirFecha(a.fecha);
                    const fechaB = convertirFecha(b.fecha);
                    return fechaA - fechaB;
                });
            }

            if (fInicio && !fFin) {
                const fechaDesde = new Date(fInicio + 'T00:00:00');
                const alumnosFiltrados = datosMostrar.filter(alumno => {
                    const fechaAlumno = convertirFecha(alumno.fecha);
                    return fechaAlumno && fechaAlumno >= fechaDesde;
                });
                
                alumnosFiltrados.sort((a, b) => {
                    const fechaA = convertirFecha(a.fecha);
                    const fechaB = convertirFecha(b.fecha);
                    return fechaA - fechaB;
                });
                
                datosMostrar = alumnosFiltrados;
            }

            if (fInicio && fFin) {
                const fechaDesde = new Date(fInicio + 'T00:00:00');
                const fechaHasta = new Date(fFin + 'T23:59:59');
                const alumnosFiltrados = datosMostrar.filter(alumno => {
                    const fechaAlumno = convertirFecha(alumno.fecha);
                    return fechaAlumno && fechaAlumno >= fechaDesde && fechaAlumno <= fechaHasta;
                });
                
                if (ordenActual === 'fecha_asc' || ordenActual === 'fecha_desc' || ordenActual === 'todos') {
                    alumnosFiltrados.sort((a, b) => {
                        const fechaA = convertirFecha(a.fecha);
                        const fechaB = convertirFecha(b.fecha);
                        return ordenActual === 'fecha_desc' ? fechaB - fechaA : fechaA - fechaB;
                    });
                }
                
                datosMostrar = alumnosFiltrados;
            }

            datosMostrar.forEach(alumno => {
                const fila = document.createElement('tr');
                fila.id = `fila-${alumno.id}`;
                fila.className = 'hover:bg-slate-800/50 transition duration-200 tabla-movil';
                
                const nombreSeguro = alumno.nombre.replace(/'/g, "\\'");
                
                fila.innerHTML = `
                    <td class="p-4 font-medium text-lg text-slate-200 break-words">${alumno.nombre}</td>
                    <td class="fecha-columna p-4 text-center text-sm text-slate-400">${alumno.fecha}</td>
                    <td class="p-4 text-right">
                        <div class="flex justify-end gap-3">
                            <button onclick="abrirModal(${alumno.id}, '${nombreSeguro}')" 
                                    class="bg-amber-500 text-black p-2 rounded-lg hover:scale-105 transition"
                                    title="Editar">
                                <i data-lucide="edit-3" class="w-4 h-4"></i>
                            </button>
                            <button onclick="abrirConfirmacion(${alumno.id})" 
                                    class="bg-red-600 text-white p-2 rounded-lg hover:scale-105 transition"
                                    title="Eliminar">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(fila);
            });
            
            lucide.createIcons();
        })
        .catch(err => {
            console.error('Error:', err);
            tbody.innerHTML = `
                <tr>
                    <td colspan="3" class="p-10 text-center text-red-500">
                        Error al cargar los datos. Por favor, intenta de nuevo.
                    </td>
                </tr>
            `;
        });
    }

    function abrirModal(id, nombre) {
        document.getElementById('editId').value = id;
        document.getElementById('editNombre').value = nombre;
        document.getElementById('modalEditar').classList.remove('hidden');
        setTimeout(() => document.getElementById('editNombre').focus(), 100);
    }
    
    function cerrarModal() { 
        document.getElementById('modalEditar').classList.add('hidden'); 
    }

    function guardarEdicion() {
        const id = document.getElementById('editId').value;
        const nombre = document.getElementById('editNombre').value.trim();
        
        if(!nombre) { 
            alert('El nombre no puede estar vac√≠o'); 
            return; 
        }

        fetch("<?= $this->url->get('hola/editar') ?>", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: id, nombre: nombre })
        })
        .then(r => r.json())
        .then(d => {
            if(d.status === 'success') {
                cargarAlumnos(); 
                cerrarModal();
                mostrarExito('Alumno actualizado correctamente');
            } else { 
                alert('Error al actualizar el alumno'); 
            }
        })
        .catch(() => alert('Error de conexi√≥n al actualizar'));
    }

    function abrirConfirmacion(id) {
        idParaEliminar = id;
        document.getElementById('modalConfirmar').classList.remove('hidden');
    }
    
    function cerrarConfirmacion() { 
        document.getElementById('modalConfirmar').classList.add('hidden'); 
        idParaEliminar = null;
    }

    function ejecutarEliminacion() {
        if(!idParaEliminar) return;
        const idLocal = idParaEliminar;
        
        fetch("<?= $this->url->get('hola/eliminar/') ?>" + idLocal, { 
            method: 'GET', 
            headers: { 'Accept': 'application/json' } 
        })
        .then(r => r.json())
        .then(d => {
            cerrarConfirmacion();
            if(d.status === 'success') {
                const fila = document.getElementById('fila-' + idLocal);
                if (fila) {
                    fila.remove();
                }
                mostrarExito('Alumno eliminado correctamente');
            } else { 
                alert('Error al eliminar el alumno'); 
            }
        })
        .catch(() => alert('Error de conexi√≥n al eliminar'));
    }

    function mostrarExito(msg) {
        document.getElementById('textoExito').innerText = msg;
        document.getElementById('modalExito').classList.remove('hidden');
        setTimeout(cerrarExito, 2000);
    }
    
    function cerrarExito() { 
        document.getElementById('modalExito').classList.add('hidden'); 
    }

    document.addEventListener('DOMContentLoaded', function() {
        cargarAlumnos();
    });
</script>
 -->